<!doctype html>
<html lang="en-CA">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Luck Test</title>
  <meta name="description" content="Pick one symbol. One click per day. Your luck, measured lightly." />
  <style>
    :root {
      --bg: #ffffff;
      --fg: #111111;
      --muted: #666666;
      --border: #e6e6e6;

      --g1: rgba(10, 122, 47, 1);     /* solid green */
      --g50: rgba(10, 122, 47, 0.5);  /* 50% green */
      --g25: rgba(10, 122, 47, 0.25); /* 25% green */

      --r1: rgba(176, 0, 32, 1);      /* solid red */
      --r50: rgba(176, 0, 32, 0.5);   /* 50% red */
      --r25: rgba(176, 0, 32, 0.25);  /* 25% red */
    }

    html, body {
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--fg);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    .wrap {
      max-width: 980px;
      margin: 0 auto;
      padding: 12px 12px 22px;
    }

    header {
      display: grid;
      gap: 6px;
      margin-bottom: 10px;
    }

    h1 {
      font-size: clamp(18px, 2.1vw, 26px);
      line-height: 1.15;
      margin: 0;
      letter-spacing: -0.02em;
    }

    .sub {
      font-size: 13px;
      color: var(--muted);
      line-height: 1.4;
    }

    .row {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 6px 10px;
      border: 1px solid var(--border);
      border-radius: 999px;
      font-size: 12px;
      color: var(--muted);
      background: #fff;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(5, minmax(0, 1fr));
      gap: 8px;
      margin-top: 8px;
    }

    .tile {
      border: 1px solid var(--border);
      background: #fff;
      border-radius: 14px;
      aspect-ratio: 1 / 1;
      display: grid;
      place-items: center;
      cursor: pointer;
      user-select: none;
      transition: transform 120ms ease, box-shadow 120ms ease, border-color 120ms ease;
      position: relative;
      overflow: hidden;
      padding: 0;
    }

    .tile:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.06);
      border-color: #d8d8d8;
    }

    .tile:active {
      transform: translateY(0px) scale(0.99);
      box-shadow: 0 4px 12px rgba(0,0,0,0.06);
    }

    .tile[disabled] {
      cursor: not-allowed;
      opacity: 0.8;
      transform: none;
      box-shadow: none;
    }

    /* Smaller icons so grid fits better */
    .icon {
      width: min(38px, 10vw);
      height: min(38px, 10vw);
      max-width: 44px;
      max-height: 44px;
      color: var(--fg);
    }

    /* Colour overlays after reveal */
    .overlay {
      position: absolute;
      inset: 0;
      opacity: 0;
      transition: opacity 140ms ease;
      pointer-events: none;
    }

    .revealed .overlay { opacity: 1; }

    .o-g1 { background: var(--g1); }
    .o-g50 { background: var(--g50); }
    .o-g25 { background: var(--g25); }

    .o-r1 { background: var(--r1); }
    .o-r50 { background: var(--r50); }
    .o-r25 { background: var(--r25); }

    /* Keep icon readable on solid colours */
    .revealed .icon {
      filter: drop-shadow(0 1px 0 rgba(255,255,255,0.5));
    }

    .panel {
      margin-top: 10px;
      border: 1px solid var(--border);
      background: #f7f7f7;
      border-radius: 16px;
      padding: 10px;
      display: grid;
      gap: 8px;
    }

    .result {
      background: #fff;
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 10px;
      display: grid;
      gap: 6px;
    }

    .result h2 {
      margin: 0;
      font-size: 14px;
    }

    .result p {
      margin: 0;
      color: var(--muted);
      line-height: 1.45;
      font-size: 13px;
    }

    .badgeRow {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 2px;
    }

    .badge {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 12px;
      color: var(--fg);
    }

    .tiny {
      font-size: 12px;
      color: var(--muted);
    }

    .btnRow {
      display: flex;
      justify-content: space-between;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    button.reset {
      appearance: none;
      border: 1px solid var(--border);
      background: #fff;
      color: var(--muted);
      border-radius: 999px;
      padding: 8px 10px;
      font-size: 12px;
      cursor: pointer;
    }

    button.reset:hover { border-color: #d8d8d8; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Choose an icon below to find out your luck score for the day.</h1>
      <div class="sub">One click per day. No do-overs. Not science.</div>
      <div class="row">
        <div class="pill" id="todayPill">Today:</div>
        <div class="pill" id="lockPill">Status:</div>
      </div>
    </header>

    <div class="grid" id="grid" aria-label="Luck symbol grid"></div>

    <div class="panel">
      <div class="result">
        <h2 id="resultTitle">Pick one.</h2>
        <p id="resultText">Then we see what the universe thinks of you today.</p>
        <div class="badgeRow" id="badgeRow" style="display:none;"></div>
      </div>

      <div class="btnRow">
        <div class="tiny" id="lockNote"></div>
        <button class="reset" id="resetBtn" type="button" title="Clears today's lock on this device.">
          Dev reset
        </button>
      </div>
    </div>
  </div>

<script>
  // ---------------------------
  // Date + per-device identity
  // ---------------------------
  function formatDateLocal(d) {
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth() + 1).padStart(2, "0");
    const dd = String(d.getDate()).padStart(2, "0");
    return `${yyyy}-${mm}-${dd}`;
  }

  function hashString(str) {
    let h = 2166136261 >>> 0;
    for (let i = 0; i < str.length; i++) {
      h ^= str.charCodeAt(i);
      h = Math.imul(h, 16777619);
    }
    return h >>> 0;
  }

  function mulberry32(seed) {
    return function() {
      let t = seed += 0x6D2B79F5;
      t = Math.imul(t ^ (t >>> 15), t | 1);
      t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
      return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
    }
  }

  function getOrCreateUID() {
    const key = "luck_uid_v2";
    let uid = localStorage.getItem(key);
    if (!uid) {
      uid = (crypto && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now()) + "_" + Math.random().toString(16).slice(2);
      localStorage.setItem(key, uid);
    }
    return uid;
  }

  const LS_LAST = "luck_last_v2";

  function loadLast() {
    try { return JSON.parse(localStorage.getItem(LS_LAST) || "null"); }
    catch { return null; }
  }
  function saveLast(obj) {
    localStorage.setItem(LS_LAST, JSON.stringify(obj));
  }

  // ---------------------------
  // Icons (25 unique SVGs)
  // Same set you already had, kept black on white.
  // ---------------------------
  const ICONS = [
    { name: "Clover", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M12 14c-1.2 2.5-3.7 4-6 4 0-2.7 1.8-5 4.2-5.6"/><path d="M12 14c1.2 2.5 3.7 4 6 4 0-2.7-1.8-5-4.2-5.6"/><path d="M12 14c-2.4 0-4.5-1.6-4.5-4 0-1.7 1.3-3 3-3 1.2 0 2.2.7 2.6 1.7.4-1 1.4-1.7 2.6-1.7 1.7 0 3 1.3 3 3 0 2.4-2.1 4-4.7 4"/><path d="M12 14v7"/></svg>` },
    { name: "Horseshoe", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M7 3c-2.2 0-4 1.8-4 4v6c0 5 4 8 9 8s9-3 9-8V7c0-2.2-1.8-4-4-4"/><path d="M7 7h.01M7 11h.01M7 15h.01M17 7h.01M17 11h.01M17 15h.01"/></svg>` },
    { name: "Star", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l2.8 6 6.5.6-4.9 4.2 1.5 6.3L12 16.9 6.1 19.1l1.5-6.3L2.7 8.6l6.5-.6L12 2z"/></svg>` },
    { name: "Coin", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><ellipse cx="12" cy="8" rx="7" ry="3"/><path d="M5 8v8c0 1.7 3.1 3 7 3s7-1.3 7-3V8"/><path d="M5 12c0 1.7 3.1 3 7 3s7-1.3 7-3"/></svg>` },
    { name: "Key", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><circle cx="7.5" cy="14.5" r="3.5"/><path d="M11 14.5h10l-2 2 2 2-2 2"/></svg>` },
    { name: "Dice", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><rect x="4" y="4" width="16" height="16" rx="3"/><path d="M8 8h.01M12 12h.01M16 16h.01"/></svg>` },
    { name: "Rabbit", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M8 7c-1.3-2.6-.6-4.5.6-5.5M12 7c.3-3.1 2-5 4-5.8"/><path d="M6.5 14.5c0-3.3 2.6-6 5.5-6s5.5 2.7 5.5 6-2.6 6-5.5 6-5.5-2.7-5.5-6z"/><path d="M10 14h.01M14 14h.01"/><path d="M11 17c.6.4 1.4.4 2 0"/></svg>` },
    { name: "Elephant", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M7 15c0-4.4 3.1-8 7-8 4 0 7 2.7 7 7v4h-4v-2H9v2H5v-3"/><path d="M14 7c-1.2 1.5-2 3.5-2 5.5 0 2.2.7 4.1 2 5.5"/><path d="M18 14c0 2-1.2 3.5-3 3.5"/></svg>` },
    { name: "Ladybug", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20c4 0 7-3.6 7-8s-3-8-7-8-7 3.6-7 8 3 8 7 8z"/><path d="M12 4v16"/><path d="M9 7h.01M15 7h.01M8 10h.01M16 10h.01"/></svg>` },
    { name: "Lantern", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M8 4h8"/><path d="M9 4c0 3-2 4-2 7s2 4 5 4 5-1 5-4-2-4-2-7"/><path d="M7 11h10"/><path d="M10 15v5h4v-5"/></svg>` },
    { name: "Crown", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M4 8l4 4 4-6 4 6 4-4v10H4V8z"/><path d="M4 18h16"/></svg>` },
    { name: "Feather", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M20 7c-4 0-8 4-10 6-2.5 2.5-3 6-3 8 2 0 5.5-.5 8-3 2-2 6-6 6-11z"/><path d="M9 13l6 6"/><path d="M11 11l4 4"/></svg>` },
    { name: "Heart", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M12 21s-7-4.4-9.5-9C.5 8 3 5.5 6 6c1.6.3 2.7 1.5 3 2 0 0 1.4-2.7 4-2.7 2.7 0 4.7 2.3 4.5 5.2C17.2 15.8 12 21 12 21z"/></svg>` },
    { name: "Moon", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M21 14.5A8.5 8.5 0 1 1 9.5 3.2 7 7 0 0 0 21 14.5z"/></svg>` },
    { name: "Sun", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v3M12 19v3M2 12h3M19 12h3M4.2 4.2l2.1 2.1M17.7 17.7l2.1 2.1M19.8 4.2l-2.1 2.1M6.3 17.7l-2.1 2.1"/></svg>` },
    { name: "Anchor", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="5" r="2"/><path d="M12 7v11"/><path d="M5 14a7 7 0 0 0 14 0"/><path d="M5 14h3M19 14h-3"/></svg>` },
    { name: "Bell", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8a6 6 0 1 0-12 0c0 7-2 7-2 7h16s-2 0-2-7"/><path d="M10 19a2 2 0 0 0 4 0"/></svg>` },
    { name: "Shield", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l8 4v7c0 5-3.5 9-8 9s-8-4-8-9V6l8-4z"/><path d="M12 6v10"/></svg>` },
    { name: "Candle", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3c1 1 1.2 2.2 0 3.2C10.8 5.2 11 4 12 3z"/><path d="M9 10h6v10H9z"/><path d="M8 20h8"/></svg>` },
    { name: "Compass", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="9"/><path d="M14.5 9.5l-2 5-5 2 2-5 5-2z"/></svg>` },
    { name: "Gem", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M6 3h12l3 6-9 12L3 9l3-6z"/><path d="M3 9h18"/><path d="M9 9l3 12 3-12"/></svg>` },
    { name: "Spiral", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M12 5a7 7 0 1 0 7 7c0-2.5-2-4-4.5-4S10 9.3 10 11.2c0 1.5 1.2 2.3 2.6 2.3 1.1 0 2-.7 2-1.7"/></svg>` },
    { name: "Hand", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M7 12V6a1 1 0 0 1 2 0v5"/><path d="M9 11V5a1 1 0 0 1 2 0v6"/><path d="M11 11V6a1 1 0 0 1 2 0v5"/><path d="M13 12V7a1 1 0 0 1 2 0v8c0 3-2 5-5 5H8c-2.2 0-4-1.8-4-4v-3c0-.8.7-1.5 1.5-1.5S7 12 7 12z"/></svg>` },
    { name: "Cup", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M7 4h10v7a5 5 0 0 1-10 0V4z"/><path d="M17 6h2a2 2 0 0 1 0 4h-2"/><path d="M8 20h8"/></svg>` },
    { name: "Maple", svg: `<svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l1.5 4L18 4l-2 4 4 1.5-4 1.5 2 4-4.5-2L12 22l-1.5-9L6 15l2-4-4-1.5L8 8 6 4l4.5 2L12 2z"/></svg>` }
  ];

  // ---------------------------
  // Core setup
  // ---------------------------
  const gridEl = document.getElementById("grid");
  const todayPill = document.getElementById("todayPill");
  const lockPill = document.getElementById("lockPill");
  const resultTitle = document.getElementById("resultTitle");
  const resultText = document.getElementById("resultText");
  const badgeRow = document.getElementById("badgeRow");
  const lockNote = document.getElementById("lockNote");
  const resetBtn = document.getElementById("resetBtn");

  const uid = getOrCreateUID();
  const todayKey = formatDateLocal(new Date());
  todayPill.textContent = `Today: ${todayKey}`;

  const seedBase = `${todayKey}|${uid}|luckgrid_v3`;
  const rng = mulberry32(hashString(seedBase));

  // Shuffle icon placement daily
  const iconOrder = Array.from({ length: 25 }, (_, i) => i);
  for (let i = iconOrder.length - 1; i > 0; i--) {
    const j = Math.floor(rng() * (i + 1));
    [iconOrder[i], iconOrder[j]] = [iconOrder[j], iconOrder[i]];
  }

  // Pick the Lucky cell (0..24)
  const luckyCell = Math.floor(rng() * 25);

  // Manhattan distance helper
  function rc(idx) {
    return { r: Math.floor(idx / 5), c: idx % 5 };
  }
  function manhattan(a, b) {
    const A = rc(a), B = rc(b);
    return Math.abs(A.r - B.r) + Math.abs(A.c - B.c);
  }

  // Pick the Unlucky cell as the farthest from Lucky
  const distances = Array.from({ length: 25 }, (_, i) => ({ i, d: manhattan(i, luckyCell) }));
  const maxD = Math.max(...distances.map(x => x.d));
  const farthest = distances.filter(x => x.d === maxD).map(x => x.i);

  // Deterministic pick among ties
  const unluckyCell = farthest[Math.floor(rng() * farthest.length)];

  function inBounds(r, c) {
    return r >= 0 && r < 5 && c >= 0 && c < 5;
  }
  function idxOf(r, c) { return r * 5 + c; }

  // Build score map: default MEH (5)
  const scoreMap = new Array(25).fill(5);
  const overlayMap = new Array(25).fill(""); // class names

  // Apply unlucky zones first (lower priority), then lucky zones override them
  function setCell(idx, score, overlayClass) {
    scoreMap[idx] = score;
    overlayMap[idx] = overlayClass;
  }

  // Unlucky zones
  setCell(unluckyCell, 0, "o-r1");

  {
    const U = rc(unluckyCell);
    // Adjacent (N S E W) = 3/10, 50% red
    const adj = [
      [U.r - 1, U.c], [U.r + 1, U.c], [U.r, U.c - 1], [U.r, U.c + 1]
    ];
    adj.forEach(([r, c]) => {
      if (inBounds(r, c)) setCell(idxOf(r, c), 3, "o-r50");
    });

    // Diagonal adjacent = 4/10, 25% red
    const diag = [
      [U.r - 1, U.c - 1], [U.r - 1, U.c + 1],
      [U.r + 1, U.c - 1], [U.r + 1, U.c + 1]
    ];
    diag.forEach(([r, c]) => {
      if (inBounds(r, c)) setCell(idxOf(r, c), 4, "o-r25");
    });
  }

  // Lucky zones override unlucky zones if overlap
  setCell(luckyCell, 10, "o-g1");

  {
    const L = rc(luckyCell);

    // Up to 4 above and below in same column = 8/10, 50% green
    for (let k = 1; k <= 4; k++) {
      const up = [L.r - k, L.c];
      const down = [L.r + k, L.c];
      if (inBounds(up[0], up[1])) setCell(idxOf(up[0], up[1]), 8, "o-g50");
      if (inBounds(down[0], down[1])) setCell(idxOf(down[0], down[1]), 8, "o-g50");
    }

    // Diagonal adjacent to lucky = 6/10, 25% green
    const diag = [
      [L.r - 1, L.c - 1], [L.r - 1, L.c + 1],
      [L.r + 1, L.c - 1], [L.r + 1, L.c + 1]
    ];
    diag.forEach(([r, c]) => {
      if (inBounds(r, c)) setCell(idxOf(r, c), 6, "o-g25");
    });

    // Re-assert lucky cell at the end
    setCell(luckyCell, 10, "o-g1");
  }

  // ---------------------------
  // Locking once per day
  // ---------------------------
  function isLockedToday() {
    const last = loadLast();
    return last && last.date === todayKey;
  }

  function setLockedUI(locked) {
    lockPill.textContent = locked ? "Status: locked for today" : "Status: one pick available";
    lockNote.textContent = locked ? "Come back tomorrow." : "Pick one icon. That is your only pick today.";
    const tiles = gridEl.querySelectorAll(".tile");
    tiles.forEach(t => {
      if (locked) t.setAttribute("disabled", "true");
      else t.removeAttribute("disabled");
    });
  }

  function labelForScore(score) {
    if (score === 10) return "SUPER LUCKY DAY";
    if (score === 8) return "VERY LUCKY DAY";
    if (score === 6) return "SLIGHTLY LUCKY";
    if (score === 5) return "MEH";
    if (score === 4) return "A BIT OFF";
    if (score === 3) return "UNLUCKY-ISH";
    if (score === 0) return "BAD LUCK DAY";
    return "MEH";
  }

  function messageForScore(score) {
    if (score === 10) return "Perfect hit. You should probably do something reckless, but in a wholesome way.";
    if (score === 8) return "Very lucky. Things may line up without you asking.";
    if (score === 6) return "Slightly lucky. Not magic, but the day might be a little smoother.";
    if (score === 5) return "Meh. A standard day in the chaos factory.";
    if (score === 4) return "A bit off. Not cursed, just… mildly resisted.";
    if (score === 3) return "Unlucky-ish. Not terrible, but don’t expect the universe to cooperate.";
    if (score === 0) return "Bad luck day. Keep liquids away from electronics. Maybe skip the lotto.";
    return "Meh.";
  }

  function revealAllTiles() {
    const tiles = gridEl.querySelectorAll(".tile");
    tiles.forEach((tile, i) => {
      tile.classList.add("revealed");
      const overlay = tile.querySelector(".overlay");
      overlay.className = `overlay ${overlayMap[i] || ""}`;
    });
  }

  function renderGrid() {
    gridEl.innerHTML = "";
    for (let cell = 0; cell < 25; cell++) {
      const iconIndex = iconOrder[cell];
      const icon = ICONS[iconIndex];

      const tile = document.createElement("button");
      tile.type = "button";
      tile.className = "tile";
      tile.setAttribute("aria-label", `Pick ${icon.name}`);

      tile.innerHTML = `
        ${icon.svg}
        <div class="overlay"></div>
      `;

      tile.addEventListener("click", () => {
        if (isLockedToday()) return;

        const score = scoreMap[cell];
        const label = labelForScore(score);

        resultTitle.textContent = `${score}/10: ${label}`;
        resultText.textContent = messageForScore(score);

        badgeRow.style.display = "flex";
        badgeRow.innerHTML = `
          <span class="badge">You picked: <strong>${icon.name}</strong></span>
          <span class="badge">Luck score: <strong>${score}/10</strong></span>
        `;

        revealAllTiles();
        saveLast({ date: todayKey, chosenCell: cell, chosenIcon: icon.name, score });
        setLockedUI(true);
      });

      gridEl.appendChild(tile);
    }
  }

  function restoreIfPlayed() {
    const last = loadLast();
    if (last && last.date === todayKey) {
      resultTitle.textContent = `${last.score}/10: ${labelForScore(last.score)}`;
      resultText.textContent = messageForScore(last.score);
      badgeRow.style.display = "flex";
      badgeRow.innerHTML = `
        <span class="badge">You picked: <strong>${last.chosenIcon}</strong></span>
        <span class="badge">Luck score: <strong>${last.score}/10</strong></span>
      `;
      revealAllTiles();
      setLockedUI(true);
      return;
    }
    setLockedUI(false);
  }

  resetBtn.addEventListener("click", () => {
    localStorage.removeItem(LS_LAST);
    resultTitle.textContent = "Pick one.";
    resultText.textContent = "Then we see what the universe thinks of you today.";
    badgeRow.style.display = "none";
    // Remove reveal state
    gridEl.querySelectorAll(".tile").forEach(tile => tile.classList.remove("revealed"));
    gridEl.querySelectorAll(".overlay").forEach(o => o.className = "overlay");
    setLockedUI(false);
  });

  renderGrid();
  restoreIfPlayed();
</script>
</body>
</html>
